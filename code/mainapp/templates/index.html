<!DOCTYPE html>
<html>
<head>
	<meta charset='UTF-8'>
	<title>Find the Force</title>
	<link rel='stylesheet' type='text/css' href='{{ url_for('static',filename='styles/main-page.css') }}'>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
	   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
	   crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
	   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
	   crossorigin=""></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>
<body>
	<div class="container">
		<div class="header"><h1>Welcome to the Force Finder || Magneto Map</h1></div>
		<div class="middle" 2px solid black>
			<div class="inputs">
			
			<!--Form used to take input from the user -->
			<div class='container'>
    			<h3>Input</h3>
				<form action="{{ url_for('handle_input') }}" method="post">
				  <div class="form-group row">
				    <label for="day" class="col-sm-2 col-form-label">Day</label>
				    <div class="col-sm-10">
				      <input type="text" class="form-control" name="day" id="day" placeholder="Day Number (DD)">
				    </div>
				  </div>
				  <div class="form-group row">
				    <label for="hour" class="col-sm-2 col-form-label">Hour</label>
				    <div class="col-sm-10">
				      <input type="password" class="form-control" name="hour" id="hour" placeholder="Hour (HH)">
				    </div>
				  </div>
				  <fieldset class="form-group">
				    <div class="row">
				      <legend class="col-form-label col-sm-2 pt-0">Dataset </legend>
				      <div class="col-sm-10">
				        <div class="form-check">
				          <input class="form-check-input" type="radio" name="dataset" id="fullDataset" value="full" checked>
				          <label class="form-check-label" for="fullDataset">
				            Full Dataset (i.e train data)
				          </label>
				        </div>
				        <div class="form-check">
				          <input class="form-check-input" type="radio" name="dataset" id="holedDataset" value="holed">
				          <label class="form-check-label" for="holedDataset">
				            Holed Dataset (i.e test data)
				          </label>
				        </div>
				      </div>
				    </div>
				  </fieldset>
				  <div class="form-group row">
				    <div class="col-sm-10">
				      <input type="Submit" name="submitBtn" class="btn btn-primary"></input>
				    </div>
				  </div>
				</form>
			</div>

			<!-- Bring in radio buttons -->
			</div>
			<div class="map">
				<div id="sitesDataMap" style="height:100%; width: 100%;">
					<script type="text/javascript">
						var mymap = L.map('sitesDataMap').setView([62.0, -96.0], 3);
						L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
							attribution: '<a href="https://www.openstreetmap.org/">OpenStreetMap</a> | <a href="https://www.mapbox.com/">Mapbox</a>',
							maxZoom: 18,
							id: 'mapbox.streets',
							accessToken: 'pk.eyJ1IjoidmlzbWF5aHIiLCJhIjoiY2syZXZ3ZjhrMGUxMjNib2Z1dnpoem5sZCJ9.vhBE1EO3Lxa6TJBy5XyaqQ'
						}).addTo(mymap);
						var jsonData = {{ data | tojson | safe }};
						var sites_data = jsonData['sites_data']
						for(row=0; row < sites_data.length; row++){
							site = sites_data[row]['name'];
							value = parseFloat(sites_data[row]['value']);
							latitude = parseFloat(sites_data[row]['lat']);
							longitude = parseFloat(sites_data[row]['lon']);
							console.log(site, value, latitude, longitude);

							var circle = L.circle([latitude, longitude], {
								color: circleOutlineColour(site),
								fillColor: circleFillColour(site),
								fillOpacity: 0.5,
								radius: value * 2000
							}).addTo(mymap);

							circle.bindPopup("Magnetic field variation at " + site + ": " + value);

							function circleOutlineColour(site){
								if(site === "MEA"){
									return("red")
								} else {
									return("green")
								}
							}

							function circleFillColour(site){
								if(site === "MEA"){
									return("#f03")
								} else {
									return("#36BF1D")
								}								
							}
						}

					</script>				
				</div>
				<script type="text/javascript">
					//console.log( {{ data.sites_data | tojson | safe }} );
				</script>
				<!-- {{ data.target_site | tojson }} -->
			</div>
		</div>
		<!-- also need footer -->
		<div class="footer">footer</div>
	</div>
</body>
</html>
